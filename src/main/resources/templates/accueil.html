<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ENI-Enchères</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 font-sans text-gray-900">

<header class="bg-blue-600 text-white py-4">
    <div class="container mx-auto flex justify-between items-center">
        <h2 class="text-2xl font-bold">ENI-Enchères</h2>
        <div class="space-x-4">
            <div th:if="${utilisateur == null}">
                <a th:href="@{/inscription}">S'inscrire</a>
                <span>|</span>
                <a th:href="@{/connexion}">Se connecter</a>
            </div>

            <div th:if="${utilisateur != null}">
                <a th:href="@{/profil}">Mon Profil</a>
                <span>|</span>
                <a th:href="@{/deconnexion}">Déconnexion</a>
            </div>
        </div>
    </div>
</header>
<section class="container mx-auto mt-8 px-4 py-6 bg-white shadow-lg rounded-lg">
    <h4 class="text-xl font-semibold mb-4">Filtres :</h4>
    <form action="/" method="get" class="space-y-4">
        <!-- Catégories -->
        <div>
            <label for="categorie" class="block text-sm font-medium text-gray-700">Catégories</label>
            <select name="categorie" id="categorie" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="" th:selected="${categorie == null or #strings.isEmpty(categorie)}">Toutes</option>

                <option th:each="cat : ${categories}"
                        th:value="${cat.libelle}"
                        th:text="${cat.libelle}"
                        th:selected="${cat.libelle == categorie}">
                </option>
            </select>
        </div>

        <!-- Nom de l'article -->
        <div>
            <label for="search" class="block text-sm font-medium text-gray-700">Nom de l'article</label>
            <input type="text" name="search" id="search" placeholder="Le nom de l'article" th:value="${search}" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Nouveaux filtres à cocher -->
        <div class="flex flex-col sm:flex-row items-start gap-4">
            <label class="inline-flex items-center">
                <input type="checkbox" name="disponibles" class="form-checkbox h-5 w-5 text-blue-600"
                       th:checked="${disponibles}">
                <span class="ml-2 text-gray-700">Afficher les enchères disponibles</span>
            </label>

            <label class="inline-flex items-center">
                <input type="checkbox" name="mesVentes" class="form-checkbox h-5 w-5 text-blue-600"
                       th:checked="${mesVentes}">
                <span class="ml-2 text-gray-700">Afficher mes ventes</span>
            </label>
        </div>

        <!-- Boutons -->
        <div class="flex flex-col sm:flex-row gap-2">
            <button type="submit" class="w-full sm:w-auto bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition">
                Rechercher
            </button>
            <a th:href="@{/}" class="w-full sm:w-auto text-center bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400 transition">
                Annuler le filtre
            </a>
        </div>
    </form>

</section>

<section class="container mx-auto mt-8 px-4">
    <h2 class="text-2xl font-bold mb-6">Enchères en cours</h2>

    <div th:if="${encheresPubliques != null}">
        <div th:each="enchere : ${encheresPubliques}" class="flex flex-col sm:flex-row bg-white shadow-md rounded-lg mb-6 overflow-hidden">
            <div class="p-6 flex flex-col justify-between w-full">
                <div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2" th:text="${enchere.article.nomArticle}">Nom de l'article</h3>
                    <p class="text-gray-700 mb-1">Prix actuel : <span th:text="${enchere.montantEnchere}">0</span> points</p>
                    <p class="text-gray-700 mb-1">Fin de l'enchère : <span th:text="${#dates.format(enchere.article.dateFinEncheres, 'dd/MM/yyyy')}"></span></p>
                    <p class="text-gray-700 mb-1">
                        Retrait :
                        <span th:text="${enchere.article.retrait.rue}"></span>,
                        <span th:text="${enchere.article.retrait.codePostal}"></span>
                        <span th:text="${enchere.article.retrait.ville}"></span>
                    </p>
                    <p class="text-gray-700 mb-1">
                        Vendeur :
                        <span th:text="${enchere.article.vendeur != null ? enchere.article.vendeur.pseudo : 'Inconnu'}"></span>
                    </p>
                </div>

                <div class="mt-4">
                    <a th:if="${utilisateur != null}"
                       th:href="@{'/enchere/getById'(id=${enchere.article.noArticle})}"
                       class="inline-block bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                        Détails
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div th:if="${encheresPubliques == null or #lists.isEmpty(encheresPubliques)}" class="text-gray-600">
        Aucune enchère disponible pour le moment.
    </div>
</section>

<div th:if="${utilisateur != null}">

    <section class="container mx-auto mt-8 px-4">
        <h2 class="text-2xl font-bold mb-4">Mes enchères en cours</h2>
        <div th:each="enchere : ${encheresParticipees}" class="bg-white p-4 rounded-lg shadow mb-4">
            <p><strong th:text="${enchere.article.nomArticle}"></strong> – <span th:text="${enchere.montantEnchere} + ' points'"></span></p>
        </div>
        <div th:if="${#lists.isEmpty(encheresParticipees)}" class="text-gray-500">Aucune enchère en cours.</div>
    </section>

    <section class="container mx-auto mt-8 px-4">
        <h2 class="text-2xl font-bold mb-4">Mes enchères gagnées</h2>
        <div th:each="enchere : ${encheresGagnees}" class="bg-white p-4 rounded-lg shadow mb-4 flex justify-between items-center">
            <div>
                <p><strong th:text="${enchere.article.nomArticle}"></strong> – Gagnée à <span th:text="${enchere.montantEnchere} + ' points'"></span></p>
            </div>
            <a th:href="@{'/enchere/getById'(id=${enchere.article.noArticle})}"
               class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                Détails
            </a>
        </div>

        <div th:if="${#lists.isEmpty(encheresGagnees)}" class="text-gray-500">Aucune enchère gagnée.</div>
    </section>

</div>


</body>
</html>
